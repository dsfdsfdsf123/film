<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>收录电影信息管理页面</title>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/default/easyui.css" />
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/icon.css" />
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>

</head>
<body style="margin:1px">
    <table id="dg" title="收录电影信息管理" class="easyui-datagrid" fitColumns="true" pagination="true" rownumbers="true" url="/admin/film/list" fit="true" toolbar="#tb">
        <thead>
            <tr>
                <th field="cb" checkbox="true" align="center"></th>
                <th field="id" checkbox="20" align="center">编号</th>
                <th field="imageName" checkbox="100" align="center" formatter="formatImageName">电影图片</th>
                <th field="name" checkbox="200" align="center">电影名称</th>
                <th field="title" checkbox="200" align="center">帖子标题</th>
                <th field="hot" checkbox="50" align="center" formatter="formatHot">热门？</th>
                <th field="publishDate" checkbox="150" align="center">发布日期</th>

            </tr>
        </thead>
    </table>
    <div id="tb">
        <div>
            <a href="javascript:openFilmModifyTab()" class="easyui-linkbutton" iconCls="icon-edit" plain="true">修改</a>
            <a href="javascript:deleteFilm()" class="easyui-linkbutton" iconCls="icon-remove" plain="true">删除</a>
        </div>

        <div>
            &nbsp;电影名称&nbsp; <input type="text" id="s_name" name="s_name" size="20" onkeydown="if (event.keyCode==13) searchFilm()" />
            <a href="javascript:searchFilm()" class="easyui-linkbutton" iconCls="icon-search" plain="true">搜索</a>
        </div>
    </div>
    
    <script type="text/javascript">

        var url;

        function searchFilm() {
            $("#dg").datagrid("load",{
                "name":$("#s_name").val(),
                "url":$("#s_url").val(),
            });
        }

        function formatImageName(val,row) {
            return "<img width=100 height=100 src='/static/fileImages/"+val+"'>";
        }
        
        function formatHot(val,row) {
            if (val==1){
                return "是";
            } else{
                return "不是";
            }
        }
        
        function deleteFilm() {
            var selectRows = $("#dg").datagrid("getSelections");
            if(selectRows.length == 0){
                $.messager.alert("请选择","要删除的数据");
            }else{
                var strIds = [];
                for (var i=0;i<selectRows.length;i++){
                    strIds.push(selectRows[i].id);
                }
                var ids = strIds.join(",");
                $.messager.confirm("系统提示","您确定删除这<strong color='red'>"+selectRows.length+"</strong>条数据吗?",function (r) {
                    if (r){
                        $.post("/admin/film/delete",{ids:ids},function (result) {
                            if (result.success){
                                $.messager.alert("系统提示","删除成功");
                                $("#dg").datagrid("reload");
                            } else{
                                $.messager.alert("系统提示",result.errorInfo);
                            }
                        },"json");
                    }
                });
            }
        }

        function openFilmModifyTab() {
            var selectRows = $("#dg").datagrid("getSelections");
            if (selectRows.length != 1){
                $.messager.alert("系统提示","请选择一条数据修改");
                return;
            }
            var row = selectRows[0];
            window.parent.openTab("修改电影",'modifyFilm.html?id='+row.id,'icon-modifyFilm');
        }

    </script>
</body>
</html>